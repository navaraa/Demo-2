<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Navaraa Staking UI</title> <!--
  <meta name="viewport" content="width=device-width, initial-scale=1.0">.    --->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <!---- connect for mobile version ---->
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');
    
    *{
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      text-decoration: none;
      border: none;
      outline: none;
      scroll-behavior: smooth;
    }
    
    body { 
      font-family: 'Poppins', sans-serif; 
      background:#f5f5f5;
    }
    
  /*______________________SECTION 1 : header design__________________*/
   .header {
     background: #a29bfe;
     box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* neeche soft transparent line */
     position: fixed;
     top: 0;
     left: 0;
     width: 100%;
     padding: 1rem 9%;
     display: flex;
     justify-content: space-between;
     align-items: center;
     z-index: 100;  
   }
    .logo-container {
      display: flex;
      align-items: center;
    }
    .logo-img {
      height: 125px;  /* apne logo ka size adjust kar sakte ho */
      width: auto;
      border-radius: 8px;
    }
    .btn { 
      background: #4CAF50;          /* green background */
      color: #fff;                  /* white text */
      font-family: 'Poppins', sans-serif;
      font-size: 28px;              /* normal readable size */
      padding: 10px 20px;           /* andar ka gap */
      border: none;
      border-radius: 10px;           /* thoda rounded */
      cursor: pointer;
      font-weight: 500;
    }
    .btn:hover { 
      background: #45a049;          /* thoda dark green */
    }
    .danger { 
      background: #e53935;          /* red */
    }
    .danger:hover {
      background: #d32f2f;          /* dark red */
    }
/*--**************************- -E N D--****************************-*/
    
    /*___________SECTION 2 & 3: WALLET INFO + Total stake count_______*/
    .main-content {
      margin-top: 150px;
      Padding: 0px 20px;
    }
    .wallet-info, 
    .total-stake {
      display: flex;
      justify-content: center;   /* horizontal center */
      margin: 20px 0;
    }
    .w-add,
    .stake-text,
    .stake-no {
      display: flex;
      align-items: center;
      background: #fff;          /* white box */
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); /* modern soft shadow */
      font-size: 28px;
      font-weight: 700;
      color: #333;
      min-width: 30%;          /* thoda bada box */
      justify-content: center;   /* icon + address center me */
    }
    .total-stake {
      gap: 20px
    }
    
    /*__________________SECTION 4 : User stake card (dymenic)____________________*/
    
    /* Container jisme cards show honge */
#stakeCards {
  display: grid;
  place-content: center;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  padding: 20px;
}

/* Har stake ka card */
.card {
  background: #1e1e2f;
  color: #fff;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* Hover effect */
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

/* Text styling */
.card p {
  margin: 8px 0;
  font-size: 16px;
}

/* Buttons */
.btn, .danger {
  display: inline-block;
  margin-top: 10px;
  padding: 10px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  transition: 0.2s ease;
}

/* Claim button */
.btn {
  background: #4cafef;
  color: white;
}

.btn:hover {
  background: #2196f3;
}

/* Withdraw button */
.danger {
  background: #f44336;
  color: white;
}

.danger:hover {
  background: #d32f2f;
}

        /*__________________SECTION 5 : Total stake count_____________________*/

    

  </style>
</head>
  <body>
  <!------------- h t m l   c o d e    h e r e ------->
    <!--- Section_1: header ( logo.png + logo text + connect wallet) ----->
      <header class="header">
        <div class="logo-container">
          <img src="logo.png" alt="Logo" class="logo-img" />
        </div>
         <button id="connectButton" class="btn">Connect Wallet</button>
      </header>
  <!----Section 2 : wallet address ---------->
    <div class="main-content" >
      <div class="wallet-info">
        <div class="w-add" id="wallet">"Not Connected"</div>
      </div>
    </div>
    <!----Section 3 : Total stake count ------>
      <div class="total-stake">
        <div class="stake-text">Total Stake:</div> 
        <div class="stake-no" id="stakeCount">-</div>
      </div>
    <!----Section 4 : User Stake Cards (dynamic) ------EXTRA---->
    <div id="stakeCards"></div>

    
  
<!---------------------J A V A S C R I P T-----S T A R T------------------------------->
  <script>
    const CONTRACT_ADDRESS = "0x9fd473975cecd4587d78eb71f4498dde778c4b83";

    const ABI = [
  "function stakeCount(address user) view returns (uint256)",
  "function pendingRewardForStake(address user, uint256 index) view returns (uint256)",
  "function getStake(address user, uint256 index) view returns (uint256 amount, uint256 startTime, uint256 claimed, bool principalWithdrawn, uint256 totalReward)",
  "function claimStakingRewards(uint256[] calldata indices)",
  "function withdrawPrincipal(uint256[] calldata indices)"
];
    
    let provider, signer, contract, userAddress;
    
    /***********Desktop+Mobile wallet connect ******/
    
async function connectWallet() {
  if (window.ethereum) {
    // ‚úÖ MetaMask (Desktop + Mobile)
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);

    // üîç Network check (Polygon only)
    const network = await provider.getNetwork();
    if (network.chainId !== 137) {
      alert("‚ö†Ô∏è Please switch to Polygon Mainnet (Chain ID 137) in your wallet.");
      return;
    }

  } else {
    // ‚úÖ Trust Wallet / Others via WalletConnect
    const wcProvider = new WalletConnectProvider.default({
      rpc: {
        137: "https://polygon-rpc.com"
      },
    });
    await wcProvider.enable();
    provider = new ethers.providers.Web3Provider(wcProvider);

    // üîç Check again
    const network = await provider.getNetwork();
    if (network.chainId !== 137) {
      alert("‚ö†Ô∏è Please switch to Polygon Mainnet (Chain ID 137).");
      return;
    }
  }

  signer = provider.getSigner();
  userAddress = await signer.getAddress();
  document.getElementById("wallet").innerText = userAddress;
  const connectBtn = document.getElementById("connectButton");
  connectBtn.innerText = "Connected";
  connectBtn.disabled = true;
  connectBtn.style.background = "#2e7d32";
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  loadInfo();
}  

    /*__________________Extra_________________*/

async function loadInfo() {
  try {
    const count = await contract.stakeCount(userAddress);
    document.getElementById("stakeCount").innerText = count.toString();

    const stakeCardsContainer = document.getElementById("stakeCards");
    stakeCardsContainer.innerHTML = ""; // purane cards clear karo

    for (let i = 0; i < count; i++) {
      const pending = await contract.pendingRewardForStake(userAddress, i);
      const stakeInfo = await contract.getStake(userAddress, i);
      
      const amount = stakeInfo.amount;  // üëà ye user ka staked principal hai

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
      <p><b>Staked Amount (stake #${i}):</b> ${ethers.utils.formatEther(amount)} tokens</p>
        <p><b>Pending Reward (stake #${i}):</b> ${ethers.utils.formatEther(pending)} tokens</p>
        <button class="btn claimBtn" data-index="${i}">Claim Reward (Stake #${i})</button><br/>
        <button class="danger withdrawBtn" data-index="${i}">Withdraw Principal (Stake #${i})</button>
      `;

      stakeCardsContainer.appendChild(card);
    }

    // Buttons ko activate karo
    document.querySelectorAll(".claimBtn").forEach(btn => {
      btn.onclick = () => claimReward(btn.dataset.index);
    });

    document.querySelectorAll(".withdrawBtn").forEach(btn => {
      btn.onclick = () => withdrawPrincipal(btn.dataset.index);
    });

  } catch (err) {
    console.error(err);
    alert("Error loading info: " + err.message);
  }
}
    async function claimReward(index) {
  try {
    const tx = await contract.claimStakingRewards([index]);
    alert("Claiming stake #" + index + " ... Tx: " + tx.hash);
    await tx.wait();
    alert("Reward claimed for stake #" + index);
    loadInfo();
  } catch (err) {
    console.error(err);
    alert("Claim failed: " + err.message);
  }
}

async function withdrawPrincipal(index) {
  try {
    const tx = await contract.withdrawPrincipal([index]);
    alert("Withdrawing stake #" + index + " ... Tx: " + tx.hash);
    await tx.wait();
    alert("Principal withdrawn for stake #" + index);
    loadInfo();
  } catch (err) {
    console.error(err);
    alert("Withdraw failed: " + err.message);
  }
}
    
    
/*-------------------------------End Extra---------------------*/
    document.getElementById("connectButton").onclick = connectWallet;
  //  document.getElementById("claimBtn").onclick = claimReward;
  //  document.getElementById("withdrawBtn").onclick = withdrawPrincipal;
  </script>
</body>
</html>


